Docker Installation
-------------------

-- yum install docker -y

-- systemctl start docker

-- systemctl status docker

-- docker -v


Commands
--------

-- docker images        [ To show list of images ]

-- docker ps             [To Show list of Containers]

There are two ways to get images

   1. Create image from Dockerfile

   2. Pull the images from dockerhub


-- docker pull amazonlinux    [ To get image amazonlinux or ubuntu from dockerhub ]

-- docker pull ubuntu           [ To get image ubuntu from dockerhub ]

-- docker images
-- docker ps -a



A Docker image is made up of multiple layers, which are stacked on top of each other. Each layer represents a set of file changes (like adding, modifying, or deleting files) and helps in optimizing storage and reusability.


Now, lets try creating a container using this images. Below command will directly login to contains as we are using -it

-- docker run -it --name amazonlinuxcontainer amazonlinux   [ To create container , -it = interactive(go inside container), amazonlinuxcontainer is a container name , amazonlinux is image ]
      -- ls
      -- yum install git maven tree httpd -y
      -- check the version
      -- touch file{1..10}

      -- ctrl p q   [ To exit from container]

If you dont want to login to container and just want to create a container and run in detach mode use -d

-- docker run -it -d --name ubuntucontainer ubuntu

-- docker ps -a  [To list all running and stopped containers]

-- docker ps    [ To list only running containers ]

If you want to access the container

-- docker attach ubuntucontainer
   apt update
   apt install nginx -y
 
      -- ctrl p q

If you want to run direct commands on container use exec

-- docker exec -it 1275f407dc04 /bin/bash

        -- apt update -y
        -- apt install git -y
        -- apt install apache2 -y
        -- service apache2 start
        -- service apache2 status

        -- ctrl p q

Docker attach and exec will help to access the container

-- docker attach 1275f407dc04

       -- ctrl p q

-- docker ps -a

docker attach
-------------
is used to attach your terminal to the standard input, output, and error streams of the main process running inside a container.
It allows you to interact with the container's main process as if you were running it directly in your terminal.

docker exec
-----------

is used to run a new command in an already running container.
This command allows you to start additional processes inside the container independently of the main process.

docker attach interacts with the container's main process (PID 1).
docker exec starts a new, separate process inside the container.

EXEC is preferred

Summary
-------

docker images
docker pull ubuntu
docker run -it --name ubuntucontainer ubuntu
docker pull amazonlinux
docker run -it -d --name amazoncontainer amazonlinux
docker exec -it 1275f407dc04 /bin/bash
docker attach 1275f407dc04

Few container commands
----------------------

docker search ubuntu        : to search images
docker ps -a            : to list all containers
docker ps             : to list runnings containers
docker stop testcontainer    : to stop the container , it will be in exit state
docker start testcontainer    : to start the container
docker restart [container]    : To Restart Container
docker pause testcontainer    : Pause processes in a running container. you cannot connect to this container,
          try docker exec -it contid /bin/bash
docker unpause cont_name        : Resume processes in a running container
docker attach testcontainer    : to go inside the container
docker inspect testcontainer    : to get
tainer
docker kill testcontainer       : to kill the container or forcibly stop the container
docker rm testcontainer         : TO delete the container
docker rm -f [container]        : Forcefully remove even if it is running
docker logs [container]        : View logs for a running container:
docker top  [container]        : Show running processes in a container:
docker stats [container]    : View live resource usage statistics for a container:
docker diff [container]        : Show changes to files or directories on the filesystem:

docker cp [file-path] CONTAINER:[path] : Copy a local file to a directory in a container:
         
             docker cp hello.txt cont1:/tmp

docker save IMAGE > IMAGE.tar   : Save an Image to tar file

             docker save ubuntu > ubuntu.tar

docker load -i IMAGE.tar    : Load an image from tar file

              docker load -i ubuntu.tar

docker history IMAGE        : Shows image history

docker image prune        : Delete unused images

docker stop containerid/containername

STOP: will wait to finish all process running inside container
KILL: wont wait to finish all process running inside container

=============================================================================================================

TASK: Pull ubuntu image and install apache and mysql server software's
------------

docker images
docker pull ubuntu
docker run -it --name ubuntucontainer ubuntu
  -- apt update -y
  -- apt install apache2 python3 mysql-server -y
  -- ctrl p q

Now we have container with name ubuntucontainer with apache2 and mysql server, lets create our image with this container ubuntucontainer
This command is used to create a image what ever data we have in the container

-- docker commit ubuntucontainer myimagewithapachenmysql

-- docker images

If you want to create a new container with this image myimagewithapachenmysql

-- docker run -it -d --name mycontwithapachemysql myimagewithapachenmysql

-- docker attach mycontwithapachemysql          [Access the container and check the version]
        -- mysql --version

ctrl pq --> after exit, container is still running
ctrl d --> container will  be stopped if you use ctl d

docker ps -a  [See container is in exit state]
docker start cont-name
docker ps -a

What we did?

Ubuntu image from dockerhub -> create a container -> Take image(custom image) -> From this images create containers again
                                 install softwares     this image
                               contains software's
manually downloaded  --> Manually created container and installed

This is not a good practise , this is manual

Clean up
---------

docker ps -a

Delete all containers
----------------------

docker ps -aq  [List only container-ids]

docker kill $(docker ps -aq)  

docker ps -a   [ All containers are in exit state ]

docker rm $(docker ps -aq)

docker ps -a

Delete all the images
---------------------

docker images -q

docker rmi -f $(docker images -q)

docker images


=============

Create a container (without starting it in iteractive mode):
------------------------------------------
docker create -it [image]

Rename an existing container:
-----------------------------
docker rename [container] [new-name]


===========================
DAY 2
===========================================================================================================================================

If you want to automate all these use Dockerfile

DOCKERFILE
----------

It is used to automate image creation.
Inside Dockerfile we use components to do our works.
Components will be on Capital Letter.
In Dockerfile D will be capital.
We can create image directly without container help
To create image from file we need to build it.

COMPONENTS:
----------

FROM        : used to get base image
RUN        : used to run linux commands (During image creation)
CMD        : used to run linux commands (After container creation)
ENTRYPOINT    : high priority than cmd
COPY        : to copy local files to container
ADD        : to copy internet files to container
WORKDIR        : to open req directory
LABEL        : to add labels for docker images
ENV        : to set env variables (inside container)
ARGS        : to pass env variables (outside containers)
EXPOSE        : to give port number

Dockerfile --> Docker Build -->  Image --> Container


Hosting Website

vi Dockerfile

FROM ubuntu
ENV course devops
ENV trainer Reyaz
EXPOSE 8080

docker build -t reyaz:v5 .
docker run -it --name cont5 reyaz:v5

echo $course
echo $trainer

ctrl pq

docker ps -a  [ Now you can see the port number for cont5 ]


First Dockerfile Task for application Deployment
===============================================

Code - GitHub --> DockerFile --> Build Image --> Create Container --> Access application

yum install git -y

git clone  https://github.com/ReyazShaik/website.git

--> dont go inside website folder, create Dockerfile outside website

vi Dockerfile

FROM ubuntu
RUN apt update
RUN apt install apache2 -y
RUN apt install apache2-utils -y
RUN apt clean
COPY website/ /var/www/html/
RUN service apache2 restart
EXPOSE 80
CMD ["/usr/sbin/apachectl", "-D", "FOREGROUND"]


-D FOREGROUND â†’ Runs Apache in the foreground mode, meaning:
Apache does not daemonize (does not run in the background).
Logs are printed to the container's stdout/stderr, making it visible with docker logs.
The process stays alive, preventing the container from exiting immediately.
Containers stop when the main process exits. Running Apache in foreground mode ensures the container remains active.


-- docker build -t firstproject:v1 .

-- docker run -itd --name newwebcont1 -p 80:80 firstproject:v1

In AWS SG , allow All traffic

http://ip

Note: docker rmi firstimage:v1 [if required]

Another example
----------------
Tomcat installation on Container
-------------------------------

vi Dockerfile

# Use the official Tomcat image as the base
FROM tomcat:latest

# Set environment variables (optional)
ENV CATALINA_HOME /usr/local/tomcat
ENV PATH $CATALINA_HOME/bin:$PATH

# Remove default webapps (optional: keeps Tomcat clean)
RUN rm -rf $CATALINA_HOME/webapps/*

# Copy your application WAR file into the Tomcat webapps directory
COPY jenkins.war $CATALINA_HOME/webapps/jenkins.war

# Expose Tomcat's default HTTP port
EXPOSE 8080

# Start Tomcat
CMD ["catalina.sh", "run"]


-- docker build -t tomcatimage:v1 .

-- docker run -itd --name tomcont -p 8080:8080 tomcatimage:v1
                                     host:container

docker exec -it 1275f407dc04 /bin/bash

http://ip:8080

From <https://classroom.google.com/c/NzI3MTQ1MzU3NjIz> 


